
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>Unity3D | KnowledgeBase</title>
<meta name="description" content="KnowledgeBase">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://sunxiaohang.github.io/favicon.ico?v=1602404125132">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://sunxiaohang.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://sunxiaohang.github.io">
        <img class="avatar" src="https://sunxiaohang.github.io/images/avatar.png?v=1602404125132" alt="" width="32px" height="32px">
      </a>
      <a href="https://sunxiaohang.github.io">
        <h1 class="site-title">KnowledgeBase</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/" class="menu purple-link">
            首页
          </a>
        
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/tags" class="menu purple-link">
            标签
          </a>
        
      
        
          <a class="menu purple-link" href="https://sunxiaohang.github.io/post/about" class="menu" target="_blank">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
          <h2 class="post-title">Unity3D</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2020-04-06</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://sunxiaohang.github.io/tag/1gmIsfBLO/">
                    Unity
                    
                      ，
                    
                  </a>
                
                  <a href="https://sunxiaohang.github.io/tag/11sEhzdYL/">
                    游戏开发
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content">
            <p>Unity3D项目关键知识点汇总，方便后期复习巩固，包括关键的monobehaviour生命周期，协程，工作线程，相机变换相关，射线投射，对象池化技术，unity中常用到的一半3D数学运算，点积、差积、欧拉角和四元数等相关笔记。</p>
<!-- more -->
<h4 id="unity-基础类图">Unity 基础类图</h4>
<figure data-type="image" tabindex="1"><img src="https://sunxiaohang.github.io/post-images/1586173848463.png" alt="" loading="lazy"></figure>
<h4 id="unity生命周期">Unity生命周期</h4>
<figure data-type="image" tabindex="2"><img src="https://sunxiaohang.github.io/post-images/1586173894549.png" alt="" loading="lazy"></figure>
<h4 id="camera">Camera</h4>
<pre><code>//-----------------------------------------------------
//-------------------通过相机的切换来实现场景的切换
/////渲染画中画(多相机){如：赛车游戏的后视镜，小地图}
/////高depth相机的画面会覆盖低depth相机画面
/////推拉变焦是摄像机同时向目标对象移动并将其缩小的视觉效果(对象大小看起来大致相同，从而达到改变其他对象视角的目的)
void Start(){
    distance = Vector3.Distance(transform.position,target.position);
    heightAtDistance = FrustumHeightAtDistance(distance);
    EnabledE();
}
void Update(){
    var distance = Vector3.Distance(transform.position,target.position);
    Camera.fieldOfView = FovForHeightAtDistance(initialDistance,CurrentDistance);
}
//----------------------------------------------------------
//------------------------射线投射-------------------------
void Start(){
    RayCastHit hit;
    //Camera.ViewPortPointToRay(0..1)坐标[0表示左下，1表示右上]
    Ray ray = Camera.ScreenPointToRay(Input.mousePosition);
    if(Physics.RayCast(ray,out hit)){
        Transform objectHit =hit.transform;
        //命中 to do
    }
}
//----------------------------------------------------------
//--------------------沿射线移动相机(缩放)----------------
void Update(){
    Ray ray = camera.ScreenPointToRay(Input.mousePOsition);
    float zoomDistance = zoomSpeed*Input.GetAxis(&quot;Vertical&quot;)*Time.deltaTime;
    Camera.tranform.Translate(ray.direction*zoomDistance,Space.world);
}
//----------------------------------------------------------
//---------------------修改斜视锥体pivot------------------
Matrix4*4 mat = Camera.main.projectionMatrix;
mat[0,2] = horizontalObl;//float(horizontal) 水平倾斜量 &lt;&quot;+&quot;&gt;向上
mat[1,2] = VerticalObl;//float(vertical) 垂直倾斜量 &lt;&quot;-&quot;&gt;向下
Camera.main.projectionMatrix = mat;
</code></pre>
<h4 id="pool">Pool</h4>
<pre><code>//----------------------------------------------------------
//---------------------game object pool------------------
public class ObjectPool : MonoBehaviour
{
   public static ObjectPool instance;
   public GameObject[] objectPrefabs;
   public List&lt;GameObject&gt;[] pooledObjects;
   public int[] amountToBuffer;
   public int defaultBufferAmount = 3;
   protected GameObject containerObject;
   void Awake (){instance = this;}
   void Start (){
       containerObject = new GameObject(&quot;ObjectPool&quot;);
       pooledObjects = new List&lt;GameObject&gt;[objectPrefabs.Length];
       int i = 0;
       foreach ( GameObject objectPrefab in objectPrefabs ){
           pooledObjects[i] = new List&lt;GameObject&gt;();  
           int bufferAmount;
           if(i &lt; amountToBuffer.Length) bufferAmount = amountToBuffer[i];
           else bufferAmount = defaultBufferAmount;
           for ( int n=0; n&lt;bufferAmount; n++){
               GameObject newObj = Instantiate(objectPrefab) as GameObject;
               newObj.name = objectPrefab.name;
               PoolObject(newObj);
           }
           i++;
       }
   }
   public GameObject GetObjectForType ( string objectType , bool onlyPooled ){
       for(int i=0; i&lt;objectPrefabs.Length; i++){
           GameObject prefab = objectPrefabs[i];
           if(prefab.name == objectType){
               if(pooledObjects[i].Count &gt; 0){
                   GameObject pooledObject = pooledObjects[i][0];
                   pooledObjects[i].RemoveAt(0);
                   pooledObject.transform.parent = null;
                   pooledObject.SetActiveRecursively(true);
                   return pooledObject;
               } else if(!onlyPooled) {
                   return Instantiate(objectPrefabs[i]) as GameObject;
               }
               break;
           }
       }
       return null;
   }
   public void PoolObject ( GameObject obj ){
       for ( int i=0; i&lt;objectPrefabs.Length; i++){
           if(objectPrefabs[i].name == obj.name){
               obj.SetActiveRecursively(false);
               obj.transform.parent = containerObject.transform;
               pooledObjects[i].Add(obj);
               return;
           }
       }
   }
}
//----------------------------------------------------------
//--------------------------effect pool--------------------
public class Effect : MonoBehaviour{
   public ParticleEmitter[] emitters;
   public float effectLength = 1f;
   public bool poolAfterComplete = true;
   public virtual void ResetEffect (){
       if(poolAfterComplete){
           ObjectPool.instance.PoolObject(gameObject);
       } else {
           Destroy(gameObject);
       }
   }
   public virtual void StartEffect (){
       foreach ( ParticleEmitter emitter in emitters ){
           emitter.Emit();
       }
       StartCoroutine(WaitForCompletion());
   }
   public IEnumerator WaitForCompletion (){
       yield return new WaitForSeconds(effectLength);
       ResetEffect();  
   }
}
//----------------------------------------------------------
//--------------------------sound pool--------------------
public class SoundEffect : MonoBehaviour{
   public AudioSource soundSource;
   public AudioClip[] soundClips;
   public float effectLength = 1f;
   public bool poolAfterComplete = true;
   public virtual void ResetEffect (){
       if(poolAfterComplete){
           ObjectPool.instance.PoolObject(gameObject);
       } else {
           Destroy(gameObject);
       }
   }
   public virtual void StartEffect (){
       soundSource.PlayOneShot(soundClips[Random.Range(0,soundClips.Length)]);
       StartCoroutine(WaitForCompletion());
   }
   public IEnumerator WaitForCompletion (){
       yield return new WaitForSeconds(effectLength);
       ResetEffect();
   }
}
</code></pre>
<h4 id="点积magnitude">点积（Magnitude）</h4>
<p>Dot Product = Ax<em>Bx+Ay</em>By+Az*Bz<br>
点积可以用于判断一个多边形是面向摄像机还是背向摄像机,(或模拟飞机飞行，通过判断飞机飞行方向与垂直地面方向的夹角判断飞机是上升还是下降)在U，V非零前提下<br>
• 点积为负=&gt;(U,V&gt;90)<br>
• 点积为正=&gt;(U,V&lt;90)<br>
• 点积为零=&gt;(U,V=90)</p>
<h4 id="差积左手定则中指为result方向结果矢量垂直与ab矢量">差积[左手定则]{中指为result方向}(结果矢量垂直与ab矢量)</h4>
<p>Vector2：A<em>B=X1</em>Y2+X2*Y1<br>
Vector3:(yz,zx,xy)<br>
Cx = AyBz-AzBy<br>
Cy = AzBx-AxBz<br>
Cz = AxBy-AyBx<br>
result = (Cx,Cy,Cz)<br>
角动量（当前指向的方向向量a，目标方向的方向向量b）求[叉积]=旋转轴</p>
<h4 id="enable-and-disable-component">Enable and Disable Component</h4>
<p>Component.enable = true|false<br>
控制一个物体是否在屏幕上渲染或显示</p>
<h4 id="active-and-deactivate-component">Active and Deactivate Component</h4>
<p>component.SetActive(false);<br>
控制是否在场景中使用该物体，findObject是否能找到<br>
SetActiveRecursively()控制递归子物体</p>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://sunxiaohang.github.io/post/unity3d-kuo-zhan-bian-ji-qi/">
              <h3 class="post-title">
                下一篇：Unity3d扩展编辑器
              </h3>
            </a>
          </div>
          
      </div>

      

      <div class="site-footer">
  <div class="slogan">KnowledgeBase</div>
  <div class="social-container">
    
      
        <a href="https://github.com/sunxiaohang" target="_blank">
          <i class="fab fa-github"></i>
        </a>
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="mailto:cssunhang@outlook.com" target="_blank">hangsun</a> | <a class="rss" href="https://sunxiaohang.github.io/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
